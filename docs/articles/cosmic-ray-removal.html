<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cosmic ray removal • hyperSpec.utils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="cosmic ray removal">
<meta property="og:description" content="hyperSpec.utils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hyperSpec.utils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hyperSpec-utils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cosmic-ray-removal.html">cosmic ray removal</a>
    </li>
    <li>
      <a href="../articles/interactive.html">Interactive data visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/konradmayer/hyperSpec.utils/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cosmic-ray-removal_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>cosmic ray removal</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/konradmayer/hyperSpec.utils/blob/master/vignettes/cosmic-ray-removal.Rmd"><code>vignettes/cosmic-ray-removal.Rmd</code></a></small>
      <div class="hidden name"><code>cosmic-ray-removal.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/cbeleites/hyperSpec">hyperSpec</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/konradmayer/hyperSpec.utils">hyperSpec.utils</a></span>)
</pre></div>
<p>CCD detectors are sensitive to cosmic rays. When acquiring Raman spectra, multiple spurious spikes can therefore appear within a measurement. These artifacts are problematic for further analysis and need to be removed. <code>{hyperSpec.utils}</code> currently includes one very simple implementation by <span class="citation">Whitaker and Hayes (2018)</span>.</p>
<p>In this vignette, the function is demonstrated on the <code>chondro</code> dataset of the package <code>{hyperSpec}</code>. It does not include any cosmic rays, therefore they are manually introduced at spectra 20 and 50, with one spike around wavenumber 800 for the former and two spikes at wavenumbers 1200 and 1400 at the latter spectrum.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">chondro_spike</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>
<span class="kw">chondro_spike</span>[[<span class="fl">20</span>, , <span class="fl">800</span>]] <span class="op">&lt;-</span> <span class="fl">5000</span>
<span class="kw">chondro_spike</span>[[<span class="fl">50</span>, , <span class="fl">1200</span>]] <span class="op">&lt;-</span> <span class="fl">6000</span>
<span class="kw">chondro_spike</span>[[<span class="fl">50</span>, , <span class="fl">1400</span>]] <span class="op">&lt;-</span> <span class="fl">4000</span>
</pre></div>
<p>The function <code><a href="../reference/crr.html">crr()</a></code> performs cosmic ray removal <span class="citation">(as described by Whitaker and Hayes 2018)</span> and returns a hyperSpec object with spikes removed as well as the data variable <code>despiked@data$crr</code> with information on the spike position. Start with higher values for the argument <code>threshold</code>, take a look at the selected spectra and iteratively decrease its value to the smallest value possible with no “normal peaks” removed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">despiked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crr.html">crr</a></span>(<span class="kw">chondro_spike</span>, threshold = <span class="fl">10</span>)
</pre></div>
<p>We can now find out what spectra contained a spike, at what wavelength they appeared and use this information to visualize the results.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">is_spike</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">despiked</span><span class="op">$</span><span class="kw">crr</span>, <span class="kw">length</span>)) <span class="op">&gt;</span> <span class="fl">0</span>
<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw">is_spike</span>)
<span class="co">#&gt; [1] 20 50</span>

(<span class="kw">spike_wavelengths</span> <span class="op">&lt;-</span> <span class="kw">despiked</span><span class="op">$</span><span class="kw">crr</span>[<span class="kw">is_spike</span>])
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 798</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 1198 1398</span>

<span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/plot.html">plot</a></span>(<span class="kw">chondro_spike</span>[<span class="kw">is_spike</span>,])
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(v = <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw">spike_wavelengths</span>), col = <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.5</span>))
</pre></div>
<p><img src="cosmic-ray-removal_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Using Raman Maps it can also be interesting to see where the identified pixels are on the map.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/plot.html">plot</a></span>(<span class="kw">despiked</span><span class="op">$</span><span class="kw">x</span>, <span class="kw">despiked</span><span class="op">$</span><span class="kw">y</span>, 
     pch = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">is_spike</span>, <span class="fl">4</span>, <span class="fl">1</span>), 
     col = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">is_spike</span>, <span class="st">'red'</span>, <span class="st">'black'</span>))
</pre></div>
<p><img src="cosmic-ray-removal_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-whitaker2018">
<p>Whitaker, Darren A., and Kevin Hayes. 2018. “A Simple Algorithm for Despiking Raman Spectra.” <em>Chemometrics and Intelligent Laboratory Systems</em> 179: 82–84. <a href="https://doi.org/10.1016/j.chemolab.2018.06.009">https://doi.org/10.1016/j.chemolab.2018.06.009</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Konrad Mayer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
