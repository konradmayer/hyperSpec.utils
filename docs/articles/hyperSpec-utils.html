<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to hyperSpec.utils • hyperSpec.utils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to hyperSpec.utils">
<meta property="og:description" content="hyperSpec.utils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hyperSpec.utils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hyperSpec-utils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cosmic-ray-removal.html">cosmic ray removal</a>
    </li>
    <li>
      <a href="../articles/interactive.html">Interactive data visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/konradmayer/hyperSpec.utils/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="hyperSpec-utils_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to hyperSpec.utils</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/konradmayer/hyperSpec.utils/blob/master/vignettes/hyperSpec-utils.Rmd"><code>vignettes/hyperSpec-utils.Rmd</code></a></small>
      <div class="hidden name"><code>hyperSpec-utils.Rmd</code></div>

    </div>

    
    
<hr>
<p>Please read the <a href="https://hyperspec.r-forge.r-project.org/documentation.html">vignettes provided with the package <code>{hyperSpec}</code></a>, as this package builts upon its functionality and class definition.</p>
<p>If you have any suggestions for new features or found bugs in the code, documentation or vignettes please file an issue at the package <a href="https://github.com/konradmayer/hyperSpec.utils/issues">GitHub repository</a>!</p>
<hr>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The package <code>{hyperSpec.utils}</code> is a collection of functions to be used with objects of the <code>hyperSpec</code> class. While it is independent from the popular <a href="https://cran.r-project.org/package=hyperSpec"><code>{hyperSpec}</code></a> package (written by Claudia Beleites), the package defining the class and including extensive functionality, <code>{hyperSpec.utils}</code> intends to add some convenient shortcuts for data analysis, some more conversion, import and export functions, tools for interactive data exploration, as well as some extended functionality (such as cosmic ray removal), especially focussing on spatially resolved spectral data (spectral maps).</p>
</div>
<div id="basic-example-preprocessing-workflow" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-example-preprocessing-workflow" class="anchor"></a>Basic example (preprocessing) workflow</h1>
<p>First, we need to load the libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/cbeleites/hyperSpec">hyperSpec</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/konradmayer/hyperSpec.utils">hyperSpec.utils</a></span>)
</pre></div>
<p>The dataset <code>chondro</code>, contained in the package <a href="http://hyperspec.r-forge.r-project.org/"><code>{hyperSpec}</code></a>, is used to demonstrate how <code>{hyperSpec.utils}</code> can be incorporated into an analysis workflow.</p>
<p>We’ll first artificially introduce some spikes to the data, as the dataset does not contain any. However, spikes due to cosmic rays are usually present in Raman measurements using a CCD detector.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">chondro_spike</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>
<span class="kw">chondro_spike</span>[[<span class="fl">20</span>, , <span class="fl">800</span>]] <span class="op">&lt;-</span> <span class="fl">5000</span>
<span class="kw">chondro_spike</span>[[<span class="fl">50</span>, , <span class="fl">1400</span>]] <span class="op">&lt;-</span> <span class="fl">4000</span>
<span class="kw">chondro_spike</span>[[<span class="fl">50</span>, , <span class="fl">1200</span>]] <span class="op">&lt;-</span> <span class="fl">5000</span>
<span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/plotspc.html">plotspc</a></span>(<span class="kw">chondro_spike</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20</span>, <span class="fl">50</span>), ])
</pre></div>
<p><img src="hyperSpec-utils_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>Now we have two spectra with spikes (one of them having even two), which appear as very narrow peaks (in this case only a single discrete wavenumber) with very high intensity. Next, we’ll use the function <code><a href="../reference/crr.html">crr()</a></code> to remove them again. This function is implemented as defined in <a href="https://doi.org/10.1016/j.chemolab.2018.06.009">this publication</a> by Whitaker et al. 2018 (following the R script provided in the supplementary material).</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">despiked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crr.html">crr</a></span>(<span class="kw">chondro_spike</span>, threshold = <span class="fl">30</span>)
<span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/plotspc.html">plotspc</a></span>(<span class="kw">despiked</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20</span>, <span class="fl">50</span>), ])
</pre></div>
<p><img src="hyperSpec-utils_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit">

<span class="co"># at what ids were spikes detected?</span>
<span class="kw">is_spike</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">despiked</span><span class="op">$</span><span class="kw">crr</span>, <span class="kw">length</span>)) <span class="op">&gt;</span> <span class="fl">0</span>
<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw">is_spike</span>)
<span class="co">#&gt; [1] 20 50</span>

<span class="co">#spike wavelengths</span>
<span class="kw">despiked</span><span class="op">$</span><span class="kw">crr</span>[<span class="kw">is_spike</span>]
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 798</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 1198 1398</span>
</pre></div>
<p>Cosmic ray removal obviously worked well. The two spectra, where we artificially introduced spikes, were identified with the correct spike positions given in <code>despiked$crr</code> (closest discrete wavenumber to the selected wavenumber 800 for spectrum number 20 and 1200 as well as 1400 for spectrum 50).</p>
<p>Lets check whether <code>despiked</code> is still an object if class <code>hyperSpec</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="../reference/is_hyperSpec.html">is_hyperSpec</a></span>(<span class="kw">despiked</span>)
<span class="co">#&gt; [1] TRUE</span>
</pre></div>
<p>But is it just a collection of spectra, or a spectral map?</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="../reference/is_hyperSpec.html">is_hyperSpecMap</a></span>(<span class="kw">despiked</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="co"># dimensions</span>
<span class="fu"><a href="../reference/spcmap_dim.html">spcmap_dim</a></span>(<span class="kw">despiked</span>)
<span class="co">#&gt;   x   y nwl </span>
<span class="co">#&gt;  35  25 300</span>
</pre></div>
<p><code>despiked</code> is spatially resolved and <code><a href="../reference/spcmap_dim.html">spcmap_dim()</a></code> provides the dimensions of the (hypothetical) spectral hypercube. While you usually know your data (and therefore also know whether its a spectral map or not) and could have easily looked up whether variables “x” and “y” exist within <code>despiked@data</code> the functions <code>is_*()</code> resp. their variants (consistent to the resp. base functions) <code>is.*()</code> are convenient shortcuts for input validation when writing new functions (but also test functions included in <code>{hyperSpec}</code> can be used).</p>
<p>To visualize the spectral map, e.g. for band 1450, we can use a modified version of <code><a href="https://rdrr.io/pkg/hyperSpec/man/levelplot.html">plotmap()</a></code>, using the <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">viridis</a> color scale as default</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="../reference/plotmap_viridis.html">plotmap_viridis</a></span>(<span class="kw">despiked</span>[ , , <span class="fl">1450</span>])
<span class="co">#&gt; Warning in levelplot.formula(spc ~ x * y, structure(list(.rownames =</span>
<span class="co">#&gt; structure(c(1L, : device support for raster images unknown, ignoring</span>
<span class="co">#&gt; 'raster=TRUE'</span>
</pre></div>
<p><img src="hyperSpec-utils_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>Baseline correction can be done using functionality provided by <a href="http://hyperspec.r-forge.r-project.org/"><code>{hyperSpec}</code></a> or <a href="https://cran.r-project.org/package=baseline"><code>{baseline}</code></a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">bl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/baselines.html">spc.fit.poly.below</a></span>(<span class="kw">despiked</span>, poly.order = <span class="fl">4</span>)
<span class="kw">baseline_corrected</span> <span class="op">&lt;-</span> <span class="kw">despiked</span> <span class="op">-</span> <span class="kw">bl</span>
<span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/plotspc.html">plotspc</a></span>(<span class="kw">baseline_corrected</span>)
</pre></div>
<p><img src="hyperSpec-utils_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>Let’s normalize on band 1450</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">normalized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalization.html">band_normalization</a></span>(<span class="kw">baseline_corrected</span>, <span class="fl">1450</span>)
<span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/plotspc.html">plotspc</a></span>(<span class="kw">normalized</span>)
</pre></div>
<p><img src="hyperSpec-utils_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>For some analysis not the complete spectra are of interest, but aggregations of certain bands</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">aggregated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_wl.html">aggregate_wl</a></span>(<span class="kw">normalized</span>, <span class="st">"mean"</span>, 
                           band_a = <span class="fl">1020</span> <span class="op">~</span> <span class="fl">1300</span>, 
                           band_b = <span class="fl">1430</span> <span class="op">~</span> <span class="fl">1470</span>, 
                           band_c = <span class="fl">1002</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">aggregated</span>[[]])
<span class="co">#&gt;         band_a    band_b    band_c</span>
<span class="co">#&gt; [1,] 0.2502085 0.7954738 0.5936036</span>
<span class="co">#&gt; [2,] 0.2489302 0.7996770 0.5923344</span>
<span class="co">#&gt; [3,] 0.2499909 0.8085492 0.5914833</span>
<span class="co">#&gt; [4,] 0.2530020 0.7865072 0.6065538</span>
<span class="co">#&gt; [5,] 0.2507131 0.7930187 0.6057977</span>
<span class="co">#&gt; [6,] 0.2531638 0.7965166 0.5871411</span>
</pre></div>
<p>Or we may want to calculate first differences:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">first_differences</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diff,hyperSpec-method.html">diff</a></span>(<span class="kw">normalized</span>)
<span class="fu"><a href="https://rdrr.io/pkg/hyperSpec/man/plotspc.html">plotspc</a></span>(<span class="kw">first_differences</span>)
</pre></div>
<p><img src="hyperSpec-utils_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Sometimes it is convenient to use the spectral hypercube of a spectral map as an array, e.g. to be used with tools for <a href="https://bioconductor.org/packages/release/bioc/vignettes/EBImage/inst/doc/EBImage-introduction.html">image analysis</a> or <a href="https://github.com/jonclayden/RNiftyReg">image registration</a> (Be careful: do image registration only in the two spatial dimensions as you usually don’t want to transform the wavenumber dimension!), or the functionality in various packages for remote sensing (e.g. using the classes defined in <a href="https://rspatial.org/raster/">{raster}</a> by further conversion of the array - e.g. <code><a href="https://rdrr.io/pkg/raster/man/brick.html">raster::brick(spcmap2array(normalized))</a></code> - with extended plotting options in <a href="https://oscarperpinan.github.io/rastervis/#intro">{rasterVis}</a>)</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">spc_array</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spcmap2array.html">spcmap2array</a></span>(<span class="kw">normalized</span>)
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">spc_array</span>)
<span class="co">#&gt;   x   y nwl </span>
<span class="co">#&gt;  35  25 300</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="kw">spc_array</span>)
<span class="co">#&gt; [1] "array"</span>
</pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Konrad Mayer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
